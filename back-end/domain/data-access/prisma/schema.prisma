generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgres"
    url      = env("DATABASE_URL")
}

model User {
    id       Int      @id @default(autoincrement())
    email    String   @unique
    password String
    profile  Profile?
}

model Profile {
    id                 Int        @id @default(autoincrement())
    username           String
    bio                String?
    createdAt          DateTime
    latestActivity     DateTime
    userId             Int        @unique
    user               User       @relation(fields: [userId], references: [id])
    publishedResources Resource[] @relation("publishedResources")
    writtenComments    Comment[]  @relation("writtenComments")
    likedResources     Like[]     @relation("likedObjects")
}

model Resource {
    id          Int       @id @default(autoincrement())
    createdAt   DateTime
    title       String
    description String
    category    String
    subject     String
    creatorId   Int       @unique
    creator     Profile   @relation("publishedResources", fields: [creatorId], references: [id])
    comments    Comment[] @relation("commentsOnResource")
    upvoters    Like[]    @relation("resourceUpvoters")
}

model Comment {
    id              Int      @id @default(autoincrement())
    message         String
    createdAt       DateTime
    profileId       Int       @unique
    profile         Profile   @relation("writtenComments", fields: [profileId], references: [id])
    resourceId      Int       @unique
    resource        Resource  @relation("commentsOnResource", fields: [resourceId], references: [id])
    likers          Like[]    @relation("commentUpvoters")
    // commentId       Int       @unique
    // parentComment   Comment?  @relation("comments", fields: [commentId], references: [id])
    // comments        Comment[] @relation("comments")
}

model Like {
    id         Int       @id @default(autoincrement())
    createdAt  DateTime
    profileId  Int       @unique
    resourceId Int       @unique
    commentId  Int       @unique
    upvoter    Profile   @relation("likedObjects", fields: [profileId], references: [id])
    resource   Resource? @relation("resourceUpvoters", fields: [resourceId], references: [id])
    comment    Comment?  @relation("commentUpvoters", fields: [commentId], references: [id])
}